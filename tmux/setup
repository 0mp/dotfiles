#! /bin/sh -

info() {
    echo $MODULE_NAME: $*
}

roll_back() {
    set +e
    info roll back due to an error
    for file in $FILES
    do
        cp -i -a -v -- "$BACKUP_DIR/.$file" "$HOME/.$file"
    done
}

set -eu

FILES='tmux.conf'
MODULE_NAME=tmux

info setup

if [ "$(uname)" = Darwin ]
then
    FILES="$FILES tmux-osx.conf"
elif [ "$(uname)" = Linux ]
then
    FILES="$FILES tmux-linux.conf"
fi

# Back up.
for file in $FILES
do
    if [ -e "$HOME/$file" ]
    then
        cp -i -a -v -- "$HOME/.$file" "$BACKUP_DIR/.$file"
    fi
done

# Install.
trap roll_back EXIT
for file in $FILES
do
    ln -s -v -f -F -n -- "$PWD/$file" "$HOME/.$file"
done
trap - EXIT

info setup done
