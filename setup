#!/bin/sh

set -eu

if [ ! "$PWD" = "$(CDPATH= cd -- "$(dirname -- "$0")" && pwd -P)" ]; then
    echo 'usage: ./setup target [target ...]'
    exit 2
fi

readonly kBACKUP_DIR="$PWD/backup/$(date +%y-%m-%d-%H-%M-%S)"
export kBACKUP_DIR

mkdir -p "$kBACKUP_DIR"

while [ "$#" -gt 0 ]; do
    cd "$1"
    ./setup
    cd ..
    shift 1
done

