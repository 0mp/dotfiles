#! /bin/sh -

set -eu

url="$(git remote get-url origin)"
url_without_protocol="${url#*//}"
url_without_protocol_and_userinfo="${url_without_protocol#*@}"

protocol="${url%${url_without_protocol}}"

domain="${url_without_protocol_and_userinfo%%[:/]*}"
path_with_dot_git="${url_without_protocol_and_userinfo#${domain}[:/]}"
path="${path_with_dot_git%.git}"

case $protocol in
http*)
    new_url="ssh://git@${domain}/${path}.git"
    ;;
ssh*)
    new_url="https://${domain}/${path}.git"
    ;;
esac

git remote set-url origin "$new_url"
