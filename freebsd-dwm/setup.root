#! /bin/sh -

. ../lib.sh

set -eu

lib_info 'setup.root'

case "$*" in
    *--install*)
        for package in dmenu $(cd /usr/ports/x11-wm/dwm/ && make all-depends-list)
        do
            dependencies="${dependencies:-}${dependencies:+ }${package#"${package%/*/*}/"}"
        done
        echo $dependencies
        pkg install --automatic --yes -- $dependencies

        case $(pkg info --locked dwm 2>/dev/null) in
            *yes) pkg unlock -y dwm ;;
        esac
        cp -f files/patch-fakefullscreen-0mp.diff /usr/ports/x11-wm/dwm/files/
        export BATCH='YES'
        export DWM_CONF="$PWD/config.h"
        cd /usr/ports/x11-wm/dwm
        make deinstall
        make clean
        make WITH=SUPERMODKEY reinstall
        rm -f /usr/ports/x11-wm/dwm/files/patch-fakefullscreen-0mp.diff
        pkg lock -y dwm
        ;;
esac

lib_info 'setup.root done'
