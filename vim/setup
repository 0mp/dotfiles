#!/bin/sh

roll_back() {
    set +e
    echo Rolling back ...
    for file in $kFiles; do
        cp -i -a -v -- "$kBACKUP_DIR/.$file" "$HOME/.$file"
    done
}

set -eu

echo Set up Vim

kFiles='vimrc vim/colors'

# Back up.
for file in $kFiles; do
    if [ -e "$HOME/$file" ]; then
        cp -i -a -v -- "$HOME/.$file" "$kBACKUP_DIR/.$file"
    fi
done

# Install.

# Preprocessing.
mkdir -p "$HOME/.vim/bundle"

# Install Vundle.
git clone https://github.com/VundleVim/Vundle.vim.git "$HOME/.vim/bundle/Vundle.vim"

trap roll_back EXIT
for file in $kFiles; do
    ln -s -v -f -F -n -- "$PWD/$file" "$HOME/.$file"
done
trap - EXIT

# Install plugins.
vim +PluginInstall +qall

# ln -s to local.vim for easier access.
# TODO
