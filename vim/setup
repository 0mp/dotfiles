#! /bin/sh -

. ../lib.sh

set -eu

vim_dir="$HOME/.vim"

lib_info setup

# 1. Install vim-plug.
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# 2. Install vimrc.
FILES='vimrc'
lib_back_up
trap lib_roll_back EXIT
lib_install
trap - EXIT

# 3. Install color schemes.
FILES='monochrome.vim monokai.vim robpike.vim'
PREFIX="$vim_dir/colors/"
colors_dir="$vim_dir/colors"
lib_back_up
if [ -h "$colors_dir" ] || [ -e "$colors_dir" ] && [ ! -d "$colors_dir" ]
then
    lib_back_up_file "$colors_dir" "${colors_dir##*/}"
    rm -rf "$colors_dir"
fi
mkdir -p "$colors_dir"
trap lib_roll_back EXIT
lib_install
trap - EXIT
PREFIX=

# 4. Install vim-plug plugins.
vim +PlugInstall +PlugUpdate +qall

# 5. Install templates.
FILES='Makefile'
PREFIX="/home/0mp/.vim/templates/"
lib_create_prefix_if_missing
lib_back_up
trap lib_roll_back EXIT
lib_install
trap - EXIT

lib_info 'setup done'
